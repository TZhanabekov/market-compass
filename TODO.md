# Market Compass ‚Äî –ü–ª–∞–Ω —Ä–∞–±–æ—Ç –∏ ToDo

> –≠—Ç–æ—Ç —Ñ–∞–π–ª –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ó–∞–¥–∞—á–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

## üõ† –¶–µ–ª–µ–≤–æ–π —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

### Frontend
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **Next.js 16** ‚úÖ | SSR/ISR, Edge Runtime –¥–ª—è –≥–µ–æ-–ª–æ–≥–∏–∫–∏ |
| **Vercel** | –•–æ—Å—Ç–∏–Ω–≥, Edge Functions, Analytics |
| **Tailwind CSS 4** ‚úÖ | –°—Ç–∏–ª–∏ |
| **shadcn/ui** ‚úÖ | UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã |
| **Zod** | –í–∞–ª–∏–¥–∞—Ü–∏—è API –æ—Ç–≤–µ—Ç–æ–≤ |

### Backend
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **FastAPI** (Python 3.11+) | REST API |
| **Docker** | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è |
| **Railway** | –î–µ–ø–ª–æ–π, –∞–≤—Ç–æ—Å–∫–µ–π–ª–∏–Ω–≥ |
| **Pydantic v2** | –°—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ |

### –î–∞–Ω–Ω—ã–µ –∏ –∫–µ—à
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **PostgreSQL** (Neon / Supabase) | –û—Å–Ω–æ–≤–Ω–∞—è –ë–î |
| **Upstash Redis** | –ö–µ—à SerpAPI (TTL —á–∞—Å—ã), –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç |
| **openexchangerates API** | –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç (TTL ~1 —á–∞—Å) |
| **Cloudflare CDN** | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å—Å–µ—Ç–æ–≤, –∑–∞—â–∏—Ç–∞ |

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Å–µ—Ä–≤–∞–±–∏–ª–∏—Ç–∏
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **GitHub Actions** | CI/CD |
| **Vitest** | Unit —Ç–µ—Å—Ç—ã |
| **Playwright** | E2E —Ç–µ—Å—Ç—ã |
| **Sentry** | Error tracking |
| **Checkly** | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API/uptime |
| **Vercel Analytics** | Web analytics |

### LLM-—Å–ª–æ–π
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **GPT-4o-mini** | –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (—Å–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏), –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ |

---

## ‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã

### Phase 0.1 ‚Äî –ú–∏–≥—Ä–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ Next.js ‚úÖ
- [x] –°–æ–∑–¥–∞–Ω Next.js 16 –ø—Ä–æ–µ–∫—Ç —Å App Router –≤ `apps/web`
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω Tailwind CSS 4 —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ç–µ–º–æ–π iPassport
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω shadcn/ui (button, card, dialog, slider, etc.)
- [x] –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
  - [x] Header, HeroSection, ModelSelector
  - [x] CompareCard, ComparisonModal
  - [x] Leaderboard, DealCard
  - [x] RiskSlider, TrustMeter, AnimatedNumber
  - [x] LocationModal
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã "use client" –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [x] –ü—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
apps/
‚îú‚îÄ‚îÄ web/           # ‚úÖ Next.js 16 (–æ—Å–Ω–æ–≤–Ω–æ–π)
‚îî‚îÄ‚îÄ api/           # Node.js/Fastify –ø—Ä–æ—Ç–æ—Ç–∏–ø (—Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ FastAPI)
```

---

## üîÑ –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏

### Cleanup
- [x] ~~–£–¥–∞–ª–∏—Ç—å `apps/web-vite`~~ ‚úÖ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (docs/) —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

---

## Phase 0.2 ‚Äî –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ç–∫–µ–Ω–¥–∞

### –°–æ–∑–¥–∞—Ç—å FastAPI backend
- [ ] –°–æ–∑–¥–∞—Ç—å `services/api` —Å FastAPI (Python 3.11+)
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:
```
services/api/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # FastAPI instance
‚îÇ   ‚îú‚îÄ‚îÄ settings.py          # Pydantic Settings
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui.py            # GET /v1/ui/home
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redirect.py      # GET /r/offers/{offerId}
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serpapi_client.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ranking.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dedup.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trust.py
‚îÇ   ‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgres.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis.py
‚îÇ   ‚îú‚îÄ‚îÄ models/              # SQLAlchemy models
‚îÇ   ‚îî‚îÄ‚îÄ schemas/             # Pydantic schemas
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ pyproject.toml
‚îî‚îÄ‚îÄ alembic/                 # Migrations
```

### Docker Compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [ ] Dockerfile –¥–ª—è FastAPI
- [ ] docker-compose.yml:
  - [ ] FastAPI app
  - [ ] PostgreSQL
  - [ ] Redis

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] PostgreSQL: —Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –≤ Neon –∏–ª–∏ Supabase
- [ ] Upstash Redis: —Å–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç–∞–Ω—Å
- [ ] Vercel: –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è `apps/web`

---

## Phase 1 ‚Äî Backend API (FastAPI)

### 1.1 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)
- [ ] SQLAlchemy models:
  - [ ] `golden_skus`
  - [ ] `merchants`
  - [ ] `offers`
  - [ ] `materialized_leaderboards`
- [ ] Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
- [ ] Seed –¥–∞–Ω–Ω—ã–µ: Golden SKU –¥–ª—è iPhone 16 Pro

### 1.2 Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Upstash)
- [ ] –ö–µ—à SerpAPI –æ—Ç–≤–µ—Ç–æ–≤ (TTL 1-6h)
- [ ] –ö–µ—à –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç (TTL ~1h)
- [ ] –ö–µ—à UI payload (TTL 30-300s)
- [ ] Locks –¥–ª—è hydration (TTL 30-120s)

### 1.3 API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- [ ] `GET /health`
- [ ] `GET /v1/ui/home?sku=...&home=...&minTrust=...&lang=...`
- [ ] `GET /r/offers/{offerId}` ‚Äî redirect —Å lazy hydration

### 1.4 –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å openexchangerates API
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis (TTL ~1 —á–∞—Å)

---

## Phase 2 ‚Äî SerpAPI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- [ ] SerpAPI –∫–ª–∏–µ–Ω—Ç (google_shopping + immersive)
- [ ] Regex extraction –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ iPhone
- [ ] GPT-4o-mini fallback –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- [ ] Trust Score (0-100)
- [ ] Ranking –ø–æ effective price
- [ ] Scheduled refresh jobs

---

## Phase 3 ‚Äî Guides (LLM + whitelist)

- [ ] –¢–∞–±–ª–∏—Ü–∞ `country_sources` (whitelist URLs)
- [ ] Facts Extraction (GPT-4o-mini) ‚Üí structured JSON
- [ ] Guide Composition ‚Üí 3-7 steps + alerts
- [ ] Multi-language –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## Phase 4 ‚Äî SEO (Next.js ISR)

- [ ] `/[sku]/[country]` dynamic routes
- [ ] ISR —Å revalidate interval
- [ ] JSON-LD: Product + AggregateOffer
- [ ] hreflang tags

---

## Phase 5 ‚Äî Admin & Observability

- [ ] Review queue –¥–ª—è low-confidence matches
- [ ] Merchant management
- [ ] Sentry + Checkly + Vercel Analytics

---

## üöÄ –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

| # | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|--------|-----------|
| 1 | –°–æ–∑–¥–∞—Ç—å FastAPI backend scaffold –≤ `services/api` | üî¥ High |
| 2 | Docker Compose (FastAPI + Postgres + Redis) | üî¥ High |
| 3 | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Neon/Supabase PostgreSQL | üü° Medium |
| 4 | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Upstash Redis | üü° Medium |
| 5 | Seed –¥–∞–Ω–Ω—ã–µ –¥–ª—è Golden SKU | üü° Medium |

---

## –ó–∞–º–µ—Ç–∫–∏

- ‚úÖ Frontend –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ Next.js 16 + Tailwind 4
- ‚úÖ pnpm –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ package manager
- –ü—Ä–æ—Ç–æ—Ç–∏–ø API (Fastify) –≤ `apps/api/src/index.ts` ‚Äî –¥–ª—è —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞
- Shared Zod schemas –≤ `packages/shared/src/index.ts` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç

## Vercel –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **Root Directory** | `apps/web` |
| **Framework Preset** | Next.js |
| **Build Command** | `pnpm build` |
| **Output Directory** | _(–æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)_ |
| **Install Command** | `pnpm install` |
